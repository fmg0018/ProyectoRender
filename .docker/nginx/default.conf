server {
    listen 80;
    server_name localhost;
    root /var/www/html/public; # Directorio raíz de Laravel

    index index.php index.html;

    charset utf-8;

    # 1. Front Controller Pattern para Laravel
    # Intenta servir el URI, si falla, reescribe a index.php
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    # 2. Configuración para PHP-FPM
    # Procesar todos los archivos .php
    location ~ \.php$ {
        # **CORRECCIÓN FINAL:** Usar el puerto TCP/IP 9000.
        # Esto coincide con la configuración de PHP-FPM y es más estable que el socket UNIX.
        fastcgi_pass 127.0.0.1:9000;
        
        # Aumentar Timeouts para evitar el 502/Empty Response si Laravel tarda en bootear
        fastcgi_read_timeout 300; 
        fastcgi_send_timeout 300;
        
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        
        include fastcgi_params;
    }

    # Evita que Nginx sirva archivos .env y otros archivos ocultos
    location ~ /\. {
        deny all;
    }

    # Configuración para archivos estáticos
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|webp)$ {
        try_files $uri =404;
        expires 1y; 
        access_log off;
        log_not_found off;
    }

    # Logs
    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log warn;
}